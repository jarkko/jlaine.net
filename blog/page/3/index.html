
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <script type="text/javascript" src="//use.typekit.net/wpe2bbi.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <meta charset="utf-8">
  <title>jlaine.net</title>
  <meta name="author" content="Jarkko Laine">

  
  <meta name="description" content="There was something in the air that night,
the stars were bright, Fernando.
They were shining there for you and me,
for liberty, Fernando.
- Björn &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jlaine.net/blog/page/3/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/feed/atom.xml" rel="alternate" title="jlaine.net" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link rel="author" href="https://plus.google.com/117033765270760829494/">
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-84654-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">jlaine.net</a></h1>
  
</hgroup>

</header>
  <!--<nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/feed/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jlaine.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>-->
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/10/02/fernando/">Fernando</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-10-02T00:00:00+03:00" pubdate data-updated="true">Oct 2<span>nd</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>There was <a href="http://developer.apple.com/iphone/program/">something in the air</a> that night,<br />
the stars were bright, Fernando.</p>
<p><a href="http://pragprog.com/">They</a> were <a href="http://blog.toolshed.com/2008/10/iphone-nda-lift.html">shining</a> <a href="http://pragprog.com/screencasts/v-bdiphone/writing-your-first-iphone-application">there</a> for <a href="http://pragmaticstudio.com/iphone/">you</a> and <a href="http://pragdave.blogs.pragprog.com/pragdave/2008/10/the-iphone-book.html">me</a>,<br />
for <a href="http://furbo.org/2008/10/01/redacted/">liberty</a>, Fernando.</p>
<p>- Björn Ulvaeus</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/09/24/a-week-of-ruby-rails-bdd-ajax-training-in-december/">A Week of Ruby/Rails/BDD/Ajax Training in December</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-09-24T00:00:00+03:00" pubdate data-updated="true">Sep 24<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After my last Ruby on Rails workshop held last year I&#8217;ve often been asked when there is going to be another one. Here it comes.</p>
<p>December 1st to 5th, we will join forces with <a href="http://tarvainen.wordpress.com/">Antti Tarvainen</a> from <a href="http://leonidasoy.com/">Leonidas</a> and give <a href="http://rapidstraining.fi/">a week of one-day workshops</a> in Helsinki with separate but closely related themes:</p>
<ol>
	<li>Beginning Ruby</li>
	<li>Beginning Rails</li>
	<li>Advanced Ruby</li>
	<li><acronym title="Behaviour-Driven Development"><span class="caps">BDD</span></acronym> on Rails</li>
	<li>Advanced Ajax on Rails</li>
</ol>
<p>You can choose as many of the days to attend to as you want to (a smörgåsbord if I may), but <em>if you will join us for the whole week, the last day will be on us</em>. The early bird price is 500€/day, with group and alumni discounts available. The price includes a plentiful lunch buffet (of course), kick-ass course materials and some goodies we&#8217;ll disclose a bit later. The course will be held in Finnish.</p>
<p>I&#8217;m really excited about the course. The last time I gave a Ruby workshop was real fun and I learned a ton from it. One thing I understood while attending Pragmatic Studios is that having more than one teacher really makes a big difference, since instead of a monologue you give the students a real <em>discussion</em> about the topics. I know Antti from a while back and know from his classes at <span class="caps">TUT</span> that he&#8217;s a great instructor, so I really look forward to being able to teach together with him.</p>
<p>Read more and register yourself for the classes from our brand-new <a href="http://rapidstraining.fi/">Rapids Training</a> website. Hope to see you all in December!</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/09/16/making-emacs-keybindings-work-with-zsh-and-screen/">Making Emacs Keybindings Work With Zsh and Screen</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-09-16T00:00:00+03:00" pubdate data-updated="true">Sep 16<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve always (as in from the early OpenACS days) been an emacs guy on linux. Sure, I do most of my development on TextMate these days, but for all text editing on servers I still prefer emacs and have its keybindings tattooed deep in my brain:</p>
<table>
	<tr>
		<td><em>Ctrl-a</em></td>
		<td>Beginning of line</td>
	</tr>
	<tr>
		<td><em>Ctrl-e</em></td>
		<td>End of line</td>
	</tr>
	<tr>
		<td><em>Ctrl-k</em></td>
		<td>Kill the rest of the line</td>
	</tr>
</table>
<p>Of course, these are the default bindings in bash as well.</p>
<p>However, I&#8217;m using <a href="http://www.mattcutts.com/blog/a-quick-tutorial-on-screen/"><span class="caps">GNU</span> screen</a> to stay sane while working over unreliable server connections. Screen uses <code>Ctrl-a</code> by default as its escape key so to make it work correctly, I&#8217;ve had this in my <code>.bash_profile</code> files for a long time:</p>
<pre><code class="shell">alias scr="TERM=vt100 ; screen -e^Oo"
alias scd="TERM=vt100 ; screen -d -r"
</code></pre>
<p>That makes (among other things) <code>Ctrl-o</code> to be the escape key binding and <em>lets <code>Ctrl-a</code> do the thing it&#8217;s supposed to do</em>.</p>
<p>However, I&#8217;ve heard so much talk about <a href="http://friedcpu.wordpress.com/2007/07/24/zsh-the-last-shell-youll-ever-need/">zsh</a> from many directions lately, that I had to try it out myself. With zsh (<a href="http://friedcpu.wordpress.com/2007/07/24/zsh-the-last-shell-youll-ever-need/"><code>.zshrc</code> downloaded from here</a>) the keys worked fine without screen, but within a screen session they broke. Here&#8217;s what I had to do to make everything work.</p>
<p>First, setting the default escape key in the screen alias command didn&#8217;t work. I had to do it in the <code>~/.screenrc</code> file instead:</p>
<pre><code class="shell">escape ^Oo
startup_message off
</code></pre>
<p>(The second line just turns off the annoying splash screen)</p>
<p>However, with this and the default key bindings <code>Ctrl-a</code> and friends still didn&#8217;t work in screen, they were just output as literals on the screen. Some determined googling finally <a href="http://my.opera.com/blackbelt_jones/blog/2007/06/05/zsh-prompt-configuration-issue-solved">turned up the key</a> (pun unintended) to the puzzle:</p>
<pre><code class="shell">bindkey -e
</code></pre>
<p>Adding that one line into my <code>.zshrc</code> among the other keybindings solved the problem. Now I&#8217;m one happy zsh+screen camper, although my journey is still at a very early stage and I&#8217;m yet to learn the more advanced zsh goodies. The nice thing has been that without learning really anything new (or changing any habits), I&#8217;m still benefiting from using zsh.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/09/09/from-rails-ajax-helpers-to-low-pro-part-3-some-announcements/">From Rails Ajax Helpers to Low Pro, Part 3 (+ Some Announcements)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-09-09T00:00:00+03:00" pubdate data-updated="true">Sep 9<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>This is the third part of my introduction to Low Pro series, something that has been taken&#8230; hmmm&#8230; a while. The two first parts can be found here:</em></p>
<ul>
	<li><a href="http://jlaine.net/2007/8/3/from-rails-ajax-helpers-to-low-pro-part-i">Part 1</a></li>
	<li><a href="http://jlaine.net/2007/8/6/from-rails-ajax-helpers-to-low-pro-part-2">Part 2</a></li>
</ul>
<p><em>Coincidentally, all these pieces are also part of my new ebook, <a href="http://peepcode.com/products/unobtrusive-prototypejs-draft">Unobtrusive Prototype</a>, straight from the Peepcode oven. If you liked the articles, you might really enjoy the book. It will have all the code rewritten for Rails 2.1 (as has this article btw), it is professionally edited unlike my rumblings here, and has a much wider coverage of Low Pro, including writing your own Behaviors and event delegation.</em></p>
<p><em>I also managed to give a <a href="http://en.oreilly.com/railseurope2008/public/schedule/detail/3584">tutorial</a> on the topics covered in the book in <a href="http://en.oreilly.com/railseurope2008/public/content/home">RailsConf Europe</a> in Berlin last week. The <a href="http://www.slideshare.net/supervillain/accessible-ajax-on-rails-presentation/">tutorial slides can be found at Slideshare</a>, where they also got a short featured treatment.</em></p>
<div style="width:425px;text-align:left" id="__ss_578598">
<p><object style="margin:0px" width="425" height="355"><br />
<param name="movie" value="http://static.slideshare.net/swf/ssplayer2.swf?doc=railsconfeurope2008-1220336237309478-9&stripped_title=accessible-ajax-on-rails-presentation" /><br />
<param name="allowFullScreen" value="true"/><br />
<param name="allowScriptAccess" value="always"/><br />
  <embed src="http://static.slideshare.net/swf/ssplayer2.swf?doc=railsconfeurope2008-1220336237309478-9&stripped_title=accessible-ajax-on-rails-presentation" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="425" height="355"><br />
  </embed><br />
</object></p>
</div>
<p><em>I moved the <a href="http://github.com/jarkko/unobtrusive_book_code/">sample code for the articles and the book</a> to <a href="http://github.com/jarkko">my GitHub account</a>. The <a href="http://github.com/jarkko/unobtrusive_book_code/tree/chapter-5">Chapter 5 branch</a> should be pretty much where this article starts at. If you&#8217;re not into git (yet), just click the &#8220;Download&#8221; button on the page to suck a zip file of the whole source code to your box.</em></p>
<h3>Going <span class="caps">DRY</span> with multiple elements</h3>
<p>Now that we have taken care of adding items to our to-do lists, let&#8217;s have a look at the the action of ticking items done and undone. The <code>index.html.erb</code> view uses the Rails&#8217; partial mechanism to display the lists of items. Here&#8217;s how the <code>_item.html.erb</code> partial looks like:</p>
<pre><code class="builder">&lt;% @item = item %&gt;
&lt;li id="&lt;%= item.state %&gt;_&lt;%= item.id %&gt;"&gt;
  &lt;%= check_box("item[]", :done, :id =&gt; "#{item.state}_box_#{item.id}") %&gt;
  &lt;label for="&lt;%= "#{item.state}_box_#{item.id}" %&gt;"&gt;
    &lt;%= item.description %&gt;
  &lt;/label&gt;
  &lt;%= observe_field("#{item.state}_box_#{item.id}", 
                    :url =&gt; item_path(item), 
                    :method =&gt; :put) %&gt;
&lt;/li&gt;
</code></pre>
<p><code>observe_field</code> is a Rails helper that attaches an Javascript observer to the field in question. Whenever the field is changed (or every <em>n</em> seconds, if the time n is given as a parameter to the <code>observe_field</code> call), an Ajax call (in this case to <code>item_path(item)</code>) is made. In our app, the responding <code>update</code> action will then update the state of the item in the database and return Javascript that will move the item to the correct list on the page.</p>
<p>Here&#8217;s an example of what the list of items looks like to the browser:</p>
<pre><code class="html">&lt;li id="undone_1"&gt;
&lt;input id="undone_box_1" name="item[1][done]" type="checkbox" value="1" /&gt;
&lt;input name="item[1][done]" type="hidden" value="0" /&gt;
&lt;label for="undone_box_1"&gt;
  Buy carrots
&lt;/label&gt;
&lt;script type="text/javascript"&gt;
//&lt;![CDATA[
new Form.Element.EventObserver('undone_box_1',
                  function(element, value) {
                    new Ajax.Request('/items/1', 
                                     {asynchronous:true, 
                                      evalScripts:true, 
                                      method:'put', 
                                      parameters:value + '&amp;authenticity_token=' +
                encodeURIComponent('8d829cfcccdf4d2b494891ef47cc95893faa361e')})})
//]]&gt;
&lt;/script&gt;
&lt;/li&gt;
&lt;li id="undone_2"&gt;
&lt;input id="undone_box_2" name="item[2][done]" type="checkbox" value="1" /&gt;
&lt;input name="item[2][done]" type="hidden" value="0" /&gt;
&lt;label for="undone_box_2"&gt;
  Return bottles to recycling
&lt;/label&gt;
&lt;script type="text/javascript"&gt;
//&lt;![CDATA[
new Form.Element.EventObserver('undone_box_2', 
                  function(element, value) {
                    new Ajax.Request('/items/2', 
                                     {asynchronous:true, 
                                       evalScripts:true, method:'put', 
                                       parameters:value + '&amp;authenticity_token=' +
                encodeURIComponent('8d829cfcccdf4d2b494891ef47cc95893faa361e')})})
//]]&gt;
&lt;/script&gt;
&lt;/li&gt;
</code></pre>
<p>Imagine a list that has a couple dozen items. Not exactly <span class="caps">DRY</span>, is it, especially compared to how clean the source code of a Rails app tends to be?</p>
<p>Even if we set aside all the objections for the ugly code above, there is still the issue of the form not working at all without Javascript. Not good.</p>
<p>Let&#8217;s again start our round of refactoring by making the checkboxes work without javascript. For that, we&#8217;ll remove the <code>observe_field</code> call from the partial:</p>
<pre><code class="builder">&lt;% @item = item %&gt;
&lt;li id="&lt;%= item.state %&gt;_&lt;%= item.id %&gt;"&gt;
  &lt;%= check_box("item[]", :done, :id =&gt; "#{item.state}_box_#{item.id}") %&gt;
  &lt;label for="&lt;%= "#{item.state}_box_#{item.id}" %&gt;"&gt;
    &lt;%= item.description %&gt;
  &lt;/label&gt;
&lt;/li&gt;
</code></pre>
<p>Now, to make our form work again, we need to figure out what it&#8217;s supposed to do and where we should send it to. Thinking restfully, by submitting a form with multiple items checked or unchecked, we are modifying a <em>to-do list</em>. Let&#8217;s thus create a simple controller for the imaginary List resource (remember, resources don&#8217;t need to map directly to ActiveRecord models).</p>
<pre><code>script/generate controller Lists</code></pre>
<p>Then add the necessary route to <code>config/routes.rb</code></p>
<pre><code class="ruby">  map.resources :items
  map.resource :list
</code></pre>
<p>For simplicity&#8217;s sake, let&#8217;s pretend our app can only handle a single to-do list (it&#8217;s our personal to-do list app, after all) and use the single form of resource routes with it.</p>
<p>In our to-do list page, we currently have a form that&#8217;s unable to submit anything. Let&#8217;s add a submit button to it and also change the form in <code>app/views/items/index.html.erb</code> to point to the lists controller:</p>
<pre><code class="builder">&lt;% form_for :list, :url =&gt; list_path, :html =&gt; {:method =&gt; :put} do |f| %&gt;
  &lt;h3&gt;
    Not done:
  &lt;/h3&gt;

  &lt;ul id="undone"&gt;
    &lt;%= render :partial =&gt; "item", :collection =&gt; @not_done %&gt;
  &lt;/ul&gt;

  &lt;h3&gt;
    Done:
  &lt;/h3&gt;

  &lt;ul id="done"&gt;
    &lt;%= render :partial =&gt; "item", :collection =&gt; @done %&gt;
  &lt;/ul&gt;
  
  &lt;p&gt;
    &lt;%= submit_tag "Save changes", :id =&gt; "save_changes" %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</code></pre>
<p>Now let&#8217;s create a really simple update action to our new controller for the mass assignment of items:</p>
<pre><code class="ruby">class ListsController &lt; ApplicationController
  def update
    params[:item].each do |key, values|
      item = Item.find(key)
      item.update_attributes(values)
    end
    
    redirect_to items_path
  end
end
</code></pre>
<p>If you now test the application with Javascript turned off, updating the item state should work fine. We can thus continue to the hijacking phase.</p>
<p>First of all, let&#8217;s hide the submit button because we don&#8217;t need it in the Ajax&#8217;ed form.</p>
<pre><code class="javascript">Event.addBehavior({
  'body' : function() {
    $('add_form').hide();
    $('add_new_link').show();
    $('save_changes').hide();
  },
  '#add_new_link:click' : function(e) {
    $('add_form').toggle();
    e.stop();
  },
  '#add_form' : Remote.Form
});
</code></pre>
<p>Now, what we need to do is to make clicking a checkbox to call the update action for the current item. This is easily done in the js file:</p>
<pre><code class="javascript">Event.addBehavior({
  'body' : function() {
    $('add_form').hide();
    $('add_new_link').show();
    $('save_changes').hide();
  },
  '#add_new_link:click' : function(e) {
    $('add_form').toggle();
    e.stop();
  },
  '#add_form' : Remote.Form,
  'input[type=checkbox]:click' : function() {
    var id = this.id.match(/\d{1,}$/);
    var auth_token = this.up('form').
                          select('[name=authenticity_token]').
                          first().value;
    new Ajax.Request('/items/' + id, 
                     {asynchronous:true, 
                      evalScripts:true, 
                      method: 'put',
                      parameters: {
                        authenticity_token: auth_token
                      }});
  }
});
</code></pre>
<p>We use the CSS3 selector syntax to get every input of type checkbox, then fetch the item id from the element id using a regular expression and finally call the update method of the items controller to update the item. The cool thing about <code>addBehaviour</code> is that the behaviour is attached to all elements returned by the selector. Thus adding a single call function to our javascript file automatically attaches the function to as many list items as needed.</p>
<p>Note that because of the spam-defense mechanism in Rails, we also need to send the authenticity token with our call. We use the cool Prototype selector functions to easily get to the current token inside the form.</p>
<p>An astute reader might have noticed that if you click an item in the list, and then try to re-click the same item after it&#8217;s moved to the opposing list, it&#8217;s not moved back automatically. This is because our Ajax update action created a new list item and added it to the list, and by default <code>Event.addBehaviour</code> does not reattach behaviours after each Ajax call.</p>
<p>We have a couple of ways to fix the situation. The simplest would be to add this line to our Javascript file:</p>
<pre><code class="javascript">Event.addBehavior.reassignAfterAjax = true;</code></pre>
<p>However, the simplest way is not always the best. By reassigning behaviours automatically after each Ajax call we can deteriorate the Javascript performance considerably, and the effect gets larger when there are more items watched.</p>
<p>Second, a bit more surgical option would be to reload the <code>addBehaviour</code> rules in a callback of the Ajax call:</p>
<pre><code class="javascript">onComplete : function() {
  Event.addBehavior.reload();
}
</code></pre>
<p>This way the behaviours would only be reassigned after the particular Ajax call, not all of them. However, it&#8217;s still a bit heavy-handed.</p>
<p>Let&#8217;s take a step back and think how we could avoid reassigning all the behaviours for the new element. An obvious answer would of course be not to create a new element at all, but instead just move the existing one (with all the behaviours already attached).</p>
<p>In app/views/items/update.js.rjs we can see that the code first removes a list item and then adds a new one into the list of items in the opposite state:</p>
<pre><code class="ruby">page["#{@item.opposite_state}_#{@item.id}"].remove
page.insert_html :top, @item.state, :partial =&gt; "item"
</code></pre>
<p>We can fairly easily change that code to not delete/create a new node to the page, but instead move the list item to the correct place in the <span class="caps">DOM</span>:</p>
<pre><code class="builder">page &lt;&lt; "
  var el = $('#{@item.opposite_state}_#{@item.id}');
  $('#{@item.state}').insert({ top: el.remove() });
  el.id = '#{@item.state}_#{@item.id}';
"
</code></pre>
<p>This time we don&#8217;t use the <span class="caps">RJS</span> syntax but instead just output plain old Javascript back to the browser. We first fetch the list element we&#8217;re about to move. We then remove it from the <span class="caps">DOM</span> tree, just to again insert it to the bottom of the list it now belongs to. In the end we change the id of the item to reflect its new state as well.</p>
<p>If you now try the app again, you should be able to tick and untick the items at will, and everything should work just fine. The behaviour assigned to the list element on the page load sticks to it through all the moving and renaming of the element.</p>
<p>&#8212;</p>
<p><a href="http://peepcode.com/products/unobtrusive-prototypejs-draft"><img src="/assets/2008/9/9/unobtrusive-cover.png" alt="" /></a></p>
<p><em>If you enjoyed the article, consider grabbing a copy of my new ebook, <a href="http://peepcode.com/products/unobtrusive-prototypejs-draft">Unobtrusive Prototype</a>, straight from the Peepcode oven. It will have all the code rewritten for Rails 2.1, it is professionally edited unlike my rumblings here, and has a much wider coverage of Low Pro, including writing your own Behaviors and event delegation. <strong>If you&#8217;re quick and have a close look at my presentation slides in the beginning of this article, you might even find a way to get your copy for half the normal price</strong>!</em></p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/06/27/sonera-s-at-it-again/">Sonera&#8217;s at It Again</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-06-27T00:00:00+03:00" pubdate data-updated="true">Jun 27<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>[<span class="caps">UPDATE</span>]</strong> Now the people in the Nordic have followed the lead of <a href="http://fuckyourogers.com">fuckyourogers.com</a>:</p>
<ul>
	<li><a href="http://www.facebook.com/group.php?gid=22113926713">iPhone: Yes please &#8211; Sonera: No thank you</a></li>
	<li><a href="http://www.facebook.com/group.php?gid=16689679566&amp;ref=nf">Bedre Telia abonnement til iPhone 3G</a></li>
	<li><a href="http://www.facebook.com/group.php?gid=31332232832">Billigere iPhone til Norge!</a></li>
	<li><a href="http://www.facebook.com/group.php?gid=21660696603">Telia dödar iPhone med kassa abonnemang.</a></li>
</ul>
<p>Sonera, the poor man&#8217;s AT&amp;T, the old Finnish national telcom that got &#8220;famous&#8221; in the dawn of the century by <a href="http://robots.cnnfn.com/2000/08/17/europe/german_umts/index.htm">buying thin German air for $7.5 Billions</a> (and later writing it off as worthless), is on fire again. The company that&#8217;s nowadays merged with its Swedish counterpart Telia, <a href="http://www.teliasonera.com/press/pressreleases/item.page?prs.itemId=360269">announced</a> a while ago that they will be the ones bringing the <a href="http://www.apple.com/iphone/">3G iPhone</a> to the Northern Europe. I guess some warning bells should have been in place considering the company is pretty much the only one that still doesn&#8217;t offer a reasonable unlimited data plan for its <span class="caps">GSM</span> customers. However, initially the excitement over iPhone finally (officially) reaching this corner of the world took over and I even considered becoming a Sonera client.</p>
<p>Today, the truth was revealed when the <a href="http://www.sonera.fi/iphone">iPhone 3G plans</a> were announced. <em>Not a single plan has unlimited data</em>. Not even the €90/month Large plan (which has 1GB/month of data). The small and medium plans come with measly 100 and 250 MB a month. Considering that watching a few YouTube movies consumes pretty much the whole monthly quota, the plans seem nothing but laughable<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup>.</p>
<p><strong>[<span class="caps">UPDATE</span>]</strong> Here&#8217;s the whole pricing table:</p>
<table>
	<tr>
		<td><em>Plan</em></td>
		<td><em>Small</em></td>
		<td><em>Medium</em></td>
		<td><em>Large</em></td>
	</tr>
	<tr>
		<td><em>Price</em></td>
		<td>31,69 €/month + 159 €/8 GB or 245 €/16 GB iPhone</td>
		<td> 51,49 €/month + 79 €/8 GB or 165 €/16 GB iPhone</td>
		<td>89,99 €/month + 1 €/8 GB or 85 €/16 GB iPhone </td>
	</tr>
	<tr>
		<td><em>Includes</em></td>
	</tr>
	<tr>
		<td>(min/month)</td>
		<td>100</td>
		<td>250</td>
		<td>1000</td>
	</tr>
	<tr>
		<td><span class="caps">SMS</span> messages/month</td>
		<td>100</td>
		<td>250</td>
		<td>1000</td>
	</tr>
	<tr>
		<td>Data (MB/month)</td>
		<td>100</td>
		<td>250</td>
		<td>1000</td>
	</tr>
	<tr>
		<td>Home Run hotspot usage</td>
		<td>yes</td>
		<td>yes</td>
		<td>yes</td>
	</tr>
	<tr>
		<td><em>Additional calls</em></td>
	</tr>
	<tr>
		<td>Starting a call</td>
		<td> 	0,049 € 	</td>
		<td>0,049 € 	</td>
		<td>0,049 € 	</td>
	</tr>
	<tr>
		<td>Cost/min</td>
		<td> 	0,079 € 	</td>
		<td>0,079 € 	</td>
		<td>0,079 € 	</td>
	</tr>
	<tr>
		<td>Additional text msg</td>
		<td> 	0,079 € 	</td>
		<td>0,079 € 	</td>
		<td>0,079 € 	</td>
	</tr>
	<tr>
		<td>Data/MB</td>
		<td> 1,49 € 	</td>
		<td>1,49 € 	</td>
		<td>1,49 €</td>
	</tr>
</table>
<p>Now, the plans might have been ok 5 years ago<sup class="footnote" id="fnr2"><a href="#fn2">2</a></sup>, but they totally overlook the platform what iPhone has become in the countries it&#8217;s been on sale so far. An iPhone is not just a phone anymore, it&#8217;s a whole new computing platform, which pretty much needs an unlimited data plan.</p>
<p>One huge selling point for the new phone will no doubt be <a href="http://www.apple.com/mobileme/">Mobile Me</a>. The chance to automatically and wirelessly sync your life between your computers and your phone sounds almost too good to be true. With €1.49/MB for the over quota data transfer, the syncing doesn&#8217;t exactly sound like a realistic option anymore.</p>
<p>Fortunately everything is not lost for us. You <em>can</em> buy the phone from Sonera even without the ridiculous plans. The 8GB and 16GB models cost €429 and €519 respectively if you don&#8217;t take any real plan with them. You <strong>do</strong> have to sign up for a custom plan for 24 months, though, but the cheapest comes at €1.99/month and thus only adds €48 to the total cost of ownership. That might just about cut it for me, but for the masses? Not so much. I hope I&#8217;ll be wrong, but to me it seems that Sonera is once again going to kill something that would&#8217;ve had potential to be something disruptive.</p>
<p>Oh well, I hear they&#8217;re going to sell cheap unlocked iPhones in Italy&#8230;</p>
<p><strong>[<span class="caps">UPDATE</span>]</strong> Gruber links to <a href="http://www.tuaw.com/2008/06/27/rogers-announces-iphone-rates-in-canada/">The Unofficial Apple Weblog&#8217;s entry about Rogers unveiling their plans</a> as well, <a href="http://daringfireball.net/linked/2008/06/27/rogers-canada">stating that &#8216;they suck&#8217;</a>. However, compared to the offering from Sonera, Rogers&#8217; plans seem to be downright cheap (even the cheapest plan comes with 400MB of data and 150 mins of weekday calls compared to 100MB and 100 mins all the time). Thanks also to Vesa for the comment about Rogers&#8217; plans.</p>
<p class="footnote" id="fn1"><a href="#fnr1"><sup>1</sup></a> The prices seem even more laughable considering that pretty much every other operator offers unlimited data plans starting from €10/month.</p>
<p class="footnote" id="fn2"><a href="#fnr2"><sup>2</sup></a> Even though we did, in fact, have unlimited <span class="caps">GPRS</span> plans in here back then, something which was unheard of in the Middle Europe where I used to live those days.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/06/02/specifying-indeces-in-datamapper/">Specifying Indeces in DataMapper</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-06-02T00:00:00+03:00" pubdate data-updated="true">Jun 2<span>nd</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve been working with <a href="http://merbivore.com/">Merb</a> and <a href="http://datamapper.org/">DataMapper</a> in the context of a new project for a week now, and the experience has been both pleasant and interesting. On one hand the stack is solid and super-fast (like, desktop app fast), on the other there are a lot of things that catch you if you don&#8217;t manage to remove the Rails hat off your head. The youth of the frameworks still shows (especially in DataMapper which has recently seen a major refactoring to make it more modular the same way Merb was reworked a bit earlier) but at the same time I get the chance to help with some really cool up-and-coming open source software. If you don&#8217;t consider that a plus, maybe you should still wait a couple months before you consider these critters for a production app.</p>
<p>One clear symptom of the young age of both Merb and DataMapper is the lack of documentation. They both have documentation sections on their respective websites and there are other efforts such as Merbunity going on, but you still have to have the guts to dive into the source code if you want to find out how some of the less common use cases work.</p>
<p>Here&#8217;s a short piece on how to declare indeces for your DataMapper models. I plan to continue publishing this kind of tutorials for other functionality as well, and to contribute them back to the &#8220;official&#8221; docs when appropriate.</p>
<h2>The big difference</h2>
<p>The big conceptual different between ActiveRecord and DataMapper is that in ActiveRecord, the place where the properties of database tables are defined are the migration files. The actual tables are then built according to the migrations and the actual model classes build their property to methods from the database schema.</p>
<p>In DataMapper, the properties are defined in the actual model file. DM has so called auto migrations that compare the model file and the database schema, and modify the schema if the two don&#8217;t match.</p>
<p>Here&#8217;s an example DataMapper model:</p>
<pre><code class="ruby">class User
  include DataMapper::Resource

  property :id,         Integer, :serial =&gt; true
  property :first_name, String
  property :last_name,  String
  property :bio,        Text
  property :single,     Boolean
end
</code></pre>
<p>Seems clean, doesn&#8217;t it. Looking at a model it is clear what properties it has and what methods it supports. But what about indeces? In AR migrations, you would use the <code>create_index</code> method. In DataMapper, <code>index</code> is an option given to the <code>property</code> method:</p>
<pre><code class="ruby">property :last_name,    String, :index =&gt; true
</code></pre>
<p>Or, if you want the index to be unique:</p>
<pre><code class="ruby">property :last_name,    String, :unique_index =&gt; true
</code></pre>
<p>OK, but what if you need multi-column composite indeces? Easy. Instead of <code>true</code>, give the index a name using a symbol:</p>
<pre><code class="ruby">property :last_name,     String, :index =&gt; :name
property :first_name,    String, :index =&gt; :name
</code></pre>
<p>This will create an index called <code>index_products_name</code> for the table, spanning columns <code>last_name</code> and <code>first_name</code>. <strong>The columns are added to the index in order of appearance</strong>, so in this case the indexing order would be <em>last name, first name</em>. If you want to change that order, just change the order of you <code>property</code> calls in the model call definition.</p>
<p>There you have it! No rocket surgery, but something I had to dive into the source code to find out.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/05/25/start-from-the-heart/">Start From the Heart</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-25T00:00:00+03:00" pubdate data-updated="true">May 25<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>My friend <a href="http://pinds.com/">Lars Pind</a> is slowly migrating himself from a software developer to a coach. His new startup is called <a href="http://startfromtheheart.com/">Start from the Heart</a>, where Lars tries to help people start companies that represent their true soul. The guiding principle behind Start from the Heart is that there should be a deeper meaning in the business you pursue than just the money. As exactly that has been a driving force behind us at <a href="http://dotherightthing.com">dotherightthing.com</a>, it&#8217;s no wonder the premise of SftH really resonated with me.</p>
<p>Lars is putting up <a href="http://startfromtheheart.com/blog/">a series of exercises</a> for the participants of the program and giving out them for free. I worked through <a href="http://startfromtheheart.com/heroes/">the first assignment</a> and must say that it&#8217;s a great one, getting a smile on your face. If you&#8217;re thinking about starting your own company (or have ever contemplated it), I would highly recommend giving Start from the Heart a try. I&#8217;m certainly enjoying it from the bottom of my heart (no pun intended).</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/05/08/amp-lified/">&amp;lified</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-08T00:00:00+03:00" pubdate data-updated="true">May 8<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong><span class="caps">UPDATE</span></strong> Now <a href="http://ampersand.gosedesign.net/">ampersand even has its own blog</a>.</p>
<p>Ampersand has received a lot of <a href="http://www.typography.com/ask/showBlog.php?blogID=98">press</a> <a href="http://www.kottke.org/08/05/ampersands">lately</a> and I decided to put my oar in as well.</p>
<p>My recent history with ampersand is kind of embarrassing, to say the least. I was giving a Ruby class in UK a few years back and during a class, I asked a participant whether there is some other term for the <em>at sign</em> in English. &#8220;Sure&#8221;, she said, &#8220;it&#8217;s ampersand.&#8221; To this day I&#8217;m not sure whether she thought I said <em>et sign</em>, or genuinely mixed up <a href="http://en.wikipedia.org/wiki/Asperand">asperand</a> and <a href="http://en.wikipedia.org/wiki/Ampersand">ampersand</a>. But for quite some time after that, I happily treated @ as ampersand.</p>
<p>But neither linguistics or typography is the topic of today&#8217;s article. Let&#8217;s rather talk about ampersand (the real one) in Ruby.</p>
<p>In Ruby, an ampersand denotes a block parameter. But let&#8217;s not get ahead of ourselves. A little background might be in place.</p>
<p>One of the coolest features in Ruby are <em>code blocks</em>, or <em>closures</em>. <del>They are basically anonymous functions, but as pretty much everything in Ruby, they are also objects.</del> They are anonymous functions, that have little use just by themselves. However, you can turn them into <code>Proc</code> objects either with the <code>Proc.new</code> constructor or using the <code>lambda</code> kernel method. The common best practice to mark code blocks is to use the curly braces with one-liners and <code>do..end</code> with blocks that span multiple lines:</p>
<pre><code class="ruby">yell = lambda { puts "AAARGH!!!" }
whisper = Proc.new do
 puts "whee"
end
yell.call
whisper.call
</code></pre>
<p>âž¥</p>
<pre><code class="ruby">AAARGH!!!
whee</code></pre>
<p>Maybe the most useful application of <code>Proc</code> objects in Ruby are block parameters. Anyone with some knowledge of Ruby is familiar with the following:</p>
<pre><code class="ruby">&gt;&gt; arr = %w(apple orange kiwi)
=&gt; ["apple", "orange", "kiwi"]
&gt;&gt; arr.each {|i| puts i[0,2]}
ap
or
ki
=&gt; ["apple", "orange", "kiwi"]</code></pre>
<p>As you can see, in this case you need to use neither <code>Proc.new</code> nor <code>lambda</code> with the block; it&#8217;s converted to a <code>Proc</code> object implicitly. But as the method receives just a <code>Proc</code> object as its parameter, you could also say something like this, right:</p>
<pre><code class="ruby">&gt;&gt; put_two = lambda {|i| puts i[0,2]}
=&gt; #&lt;Proc:0x00329060@(irb):41&gt;
&gt;&gt; arr.each(put_two)</code></pre>
<p>Err, not quite. It turns out Ruby methods can take two kinds of parametersâ€”a number of normal parameters and a block parameter. In the code above the interpreter will think that the <code>put_two</code> <code>Proc</code> object is passed as a normal parameter to the <code>each</code> call, and since <code>each</code> doesn&#8217;t take any normal parameters, you will get an error:</p>
<pre><code class="ruby">&gt;&gt; arr.each(put_two)
ArgumentError: wrong number of arguments (1 for 0)
	from (irb):42:in `each'
	from (irb):42</code></pre>
<p>And this is what brings us back to the ampersand:</p>
<pre><code class="ruby">&gt;&gt; arr.each(&amp;put_two)
ap
or
ki
=&gt; ["apple", "orange", "kiwi"]</code></pre>
<p>So <strong>the ampersand is used to tell the interpreter that the following reference is the block parameter of the method</strong>.</p>
<p>One fairly common idiom in the Rails world is this kind of construct:</p>
<pre><code class="ruby">&gt;&gt; arr.map(&amp;:length)</code></pre>
<p>It is effectively the same as</p>
<pre><code class="ruby">&gt;&gt; arr.map {|i| i.length }
=&gt; [5, 6, 4]</code></pre>
<p>However, if you start a plain irb session, you will notice something isn&#8217;t quite right:</p>
<pre><code class="ruby">&gt;&gt; arr.map(&amp;:length)
TypeError: wrong argument type Symbol (expected Proc)
	from (irb):2</code></pre>
<p>That&#8217;s right. The cool shorthand method that worked so nicely in your Rails app doesn&#8217;t work in plain Ruby. That&#8217;s because there is some Rails magic behind the <code>&amp;:method</code> call. This magic is e.g. the reason why <a href="http://goruco2008.confreaks.com/06_zygmuntowicz.html">Ezra has prohibited using the shortcut in Merb framework code</a>.</p>
<p>But let&#8217;s have a closer look at what&#8217;s actually happening behind the scenes in the shortcut. The thing that&#8217;s different from our earlier calls is that there is a colon between the ampersand and the word &#8220;length&#8221;. This means that we&#8217;re not using a variable or method called <code>length</code>, but the symbol <code>:length</code>. If you&#8217;re not familiar with Ruby symbols (or even if you are), reading <a href="http://blog.hasmanythrough.com/2008/4/19/symbols-are-not-pretty-strings">Josh&#8217;s recent article on symbols</a> is a worthwhile read.</p>
<p>Now that we know that we&#8217;re trying to pass a symbol as the block parameter to a method (and that it&#8217;s not really working, as the error above indicates), we need a way to convert it to a <code>Proc</code> object like expected by the method. Ruby has a slew of type conversion methods that are called implicitly whenever it&#8217;s clear that a certain type of object is needed. Inside a string for example, <code>to_s</code> is called automatically for every object that is not a string itself:</p>
<pre><code class="ruby">&gt;&gt; "Nice array: " + arr
TypeError: can't convert Array into String
	from (irb):6:in `+'
	from (irb):6
&gt;&gt; "Nice array: #{arr}"
=&gt; "Nice array: appleorangekiwi"
&gt;&gt; "Nice array: " + arr.to_s
=&gt; "Nice array: appleorangekiwi"</code></pre>
<p>In the same vein, since a block parameter of a method needs to be a <code>Proc</code> object, <code>to_proc</code> is called automatically for all other objects in an effort to get a hold of a proc.  So could it work if we just added a <code>to_proc</code> method to the <code>Symbol</code> class? Let&#8217;s find out!</p>
<pre><code class="ruby">class Symbol
  def to_proc
    lambda {|i| i.send(self)}
  end
end</code></pre>
<p><del>Here we make <code>to_proc</code> a lambda function that will use the <code>send</code> method to call the method with the same name as the <code>Symbol</code> object in question (self) for the element that&#8217;s passed to it.</del> <em>(That got too confusing so let&#8217;s just use examples)</em>.  So</p>
<pre><code class="ruby">arr.send(:length)</code></pre>
<p>is the same as</p>
<pre><code class="ruby">arr.length</code></pre>
<p>And thus</p>
<pre><code class="ruby">:length.to_proc</code></pre>
<p>would become</p>
<pre><code class="ruby">lambda {|i| i.send(:length)}</code></pre>
<p>Now, let&#8217;s see how our new method performs:</p>
<pre><code class="ruby">&gt;&gt; arr.map(&amp;:reverse)
=&gt; ["elppa", "egnaro", "iwik"]</code></pre>
<p>Perfect!</p>
<p>While <code>Symbol#to_proc</code> is a clever and perhaps an elegant hack, it&#8217;s still kind of a hack. So should you use it in your code? I tend to side with Ezra on this. If you&#8217;re writing framework code, you should probably err on the side of readability and common usage, and thus avoid &#8220;magical shortcuts&#8221; like these. But in application code, why not. I certainly do.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/05/05/making-capistrano-not-pant-on-cleanup/">Making Capistrano Not Suffocate on Cleanup</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-05T00:00:00+03:00" pubdate data-updated="true">May 5<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When trying to deploy an app on the production server, the <code>deploy:cleanup</code> task always died for me like this:</p>
<pre><code>  * executing `deploy:cleanup'
  * executing "ls -x /opt/sites/mysite/releases"
    servers: ["myserver"]
    [myserver] executing command
    command finished
 ** keeping 3 of 4 deployed releases
  * executing "rm -rf /opt/sites/mysite/releases/20080220092659"
    servers: ["myserver"]
    [myserver] executing command
 ** [out :: myserver] sudo: no passwd entry for app!
 ** [out :: myserver] 
    command finished
command "rm -rf /opt/sites/mysite/releases/20080220092659" failed on myserver
</code></pre>
<p>Turns out capistrano is for some reason trying to use a user called <em>app</em> in the cleanup task even though the <code>:user</code> parameter is set to something else in <code>config/deploy.rb</code>. The solution was to set the <code>:runner</code> parameter as well:</p>
<pre><code class="ruby">set :runner, 'someotheruser'
</code></pre>
<p>Don&#8217;t ask me why that worked. It seems a bit counterintuitive that the cleanup task uses the <code>runner</code> param rather than <code>user</code>. Found the hint towards the solution <a href="http://groups.google.com/group/capistrano/browse_thread/thread/0d396a96d1946ba3">here</a>.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/04/22/hate-to-say/">Hate to Say&#8230;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-04-22T00:00:00+03:00" pubdate data-updated="true">Apr 22<span>nd</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>December 2007</h3>
<blockquote>
<p>For gawd&#8217;s sake, what did they smoke in your company&#8217;s Christmas party?</p>
</blockquote>
<p><em>(A text message I sent to my buddy Thomas who works in Sampo Pankki in reference to the news that the bank (recently bought by Danske Bank) would deploy a new &#8220;security&#8221; system (that uses a Java applet) in their online banking solution).</em></p>
<h3>April 2008</h3>
<blockquote>
<p>The latest reactions inclule [sic] 52-year old male customer returing to the bank with an axe after hearing that his account is empty, money exchange company Forex stopping accepting payment cards from Sampo Bank and Sampo Bank customers not being able to buy train tickets online.</p>
</blockquote>
<p>(<a href="http://janne.blogit.kauppalehti.fi/2008/04/03/finnish-sampo-banks-ict-problems-cause-extreme-reactions-in-their-clientele/">Finnish Sampo Bankâ€™s <span class="caps">ICT</span> problems cause extreme reactions in their clientele</a>)</p></div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/4/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>

    </div>
  </div>
  <footer role="contentinfo"><ul>
  <li><a href="http://jlaine.net/jarkko">About Jarkko</a></li>
  <li><a href="http://notkea.fi"><strong>NOTKEA.FI</strong> – Notkeita ajatuksia taloudesta, teknologiasta ja elämästä suomeksi</a></li>
</ul>

<p>
  Copyright &copy; 2013 - Jarkko Laine -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '50b05efb613f5d7127000040');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>

</body>
</html>
