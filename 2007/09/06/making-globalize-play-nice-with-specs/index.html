
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <script type="text/javascript" src="//use.typekit.net/wpe2bbi.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <meta charset="utf-8">
  <title>Making Globalize play nice with specs - jlaine.net</title>
  <meta name="author" content="Jarkko Laine">

  
  <meta name="description" content="We&#8217;re using Globalize for our latest Rails project and I just ran against a problem when running specs with rake.
We specify the base language &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jlaine.net/2007/09/06/making-globalize-play-nice-with-specs/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/feed/atom.xml" rel="alternate" title="jlaine.net" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-84654-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">jlaine.net</a></h1>
  
</hgroup>

</header>
  <!--<nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/feed/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jlaine.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>-->
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Making Globalize Play Nice With Specs</h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-09-06T00:00:00+01:00" pubdate data-updated="true">Sep 6<span>th</span>, 2007</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>We&#8217;re using <a href="http://www.globalize-rails.org/globalize/">Globalize</a> for our latest Rails project and I just ran against a problem when running specs with rake.</p>
<p>We specify the base language and the locales our app supports in environment.rb:</p>
<pre><code class="ruby">include Globalize
Locale.set_base_language('en-US')
SupportedLocales.define(['fi-FI', 'sv-SE', 'en-US'], 'en-US')
</code></pre>
<p>However, <code>SupportedLocales.define</code> expects that the language and country data exists in the database, otherwise it will die miserably. Of course, when you run specs with rake, it will wipe the database as its first action so you&#8217;re pretty much out of luck:</p>
<pre><code>.../vendor/plugins/globalize/lib/globalize/localization/supported_locales.rb:282:in `setup': Globalize base language undefined! (RuntimeError)</code></pre>
<p>I fixed this by copying the <code>db:test:clone</code> rake task from <code>[RAILS]/railties/lib/tasks/databases.rake</code> to its own file in <code>lib/tasks</code> and modifying it so that it will load some language and country fixtures automatically:</p>
<pre><code class="ruby">require(File.join(RAILS_ROOT, 'vendor', 'rails', 'activerecord', 'lib', 'active_record', 'fixtures'))

namespace :db do
  namespace :test do
    desc "Recreate the test database from the current environment's database schema"
    task :clone =&gt; %w(db:schema:dump db:test:purge) do
      ActiveRecord::Base.establish_connection(ActiveRecord::Base.configurations['test'])
      ActiveRecord::Schema.verbose = false
      Rake::Task["db:schema:load"].invoke
      Fixtures.create_fixtures("#{RAILS_ROOT}/spec/fixtures", [:globalize_countries, :globalize_languages])
    end
  end
end
</code></pre>
<p>The only thing differing from the original task is the last line creating the fixtures. For some reasons I also need to explicitly require the fixtures file on the top of the file. Aside from this, I needed to change Rakefile in the root of our Rails app to require <code>config/environment.rb</code> instead of <code>config/boot.rb</code> for everything to work.</p>
<p>Of course your fixture files need to include all the languages and countries you&#8217;re specifying in your <code>SupportedLocales.define</code> call.</p>
<p>After these modifications, rake runs through fine again.</p></div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jarkko Laine</span></span>

      








  


<time datetime="2007-09-06T00:00:00+01:00" pubdate data-updated="true">Sep 6<span>th</span>, 2007</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://jlaine.net/2007/09/06/making-globalize-play-nice-with-specs/" data-via="" data-counturl="http://jlaine.net/2007/09/06/making-globalize-play-nice-with-specs/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2007/08/22/langaton-tampere/" title="Previous Post: Langaton Tampere">&laquo; Langaton Tampere</a>
      
      
        <a class="basic-alignment right" href="/2007/09/19/iphone-vs-nokia-e90-communicator/" title="Next Post: iPhone vs. Nokia E90 Communicator">iPhone vs. Nokia E90 Communicator &raquo;</a>
      
    </p>
  </footer>
</article>

</div>


    </div>
  </div>
  <footer role="contentinfo"><ul>
  <li><a href="http://jlaine.net/jarkko">About Jarkko</a></li>
  <li><a href="http://notkea.fi"><strong>NOTKEA.FI</strong> – Notkeita ajatuksia taloudesta, teknologiasta ja elämästä suomeksi</a></li>
</ul>

<p>
  Copyright &copy; 2013 - Jarkko Laine -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '50b05efb613f5d7127000040');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>

</body>
</html>
