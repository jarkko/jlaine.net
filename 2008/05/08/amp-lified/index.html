
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <script type="text/javascript" src="//use.typekit.net/wpe2bbi.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <meta charset="utf-8">
  <title>&amp;lified - jlaine.net</title>
  <meta name="author" content="Jarkko Laine">

  
  <meta name="description" content="UPDATE Now ampersand even has its own blog.
Ampersand has received a lot of press lately and I decided to put my oar in as well.
My recent history &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jlaine.net/2008/05/08/amp-lified/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/feed/atom.xml" rel="alternate" title="jlaine.net" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-84654-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">jlaine.net</a></h1>
  
</hgroup>

</header>
  <!--<nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/feed/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jlaine.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>-->
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">&amp;lified</h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-08T00:00:00+03:00" pubdate data-updated="true">May 8<span>th</span>, 2008</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><strong><span class="caps">UPDATE</span></strong> Now <a href="http://ampersand.gosedesign.net/">ampersand even has its own blog</a>.</p>
<p>Ampersand has received a lot of <a href="http://www.typography.com/ask/showBlog.php?blogID=98">press</a> <a href="http://www.kottke.org/08/05/ampersands">lately</a> and I decided to put my oar in as well.</p>
<p>My recent history with ampersand is kind of embarrassing, to say the least. I was giving a Ruby class in UK a few years back and during a class, I asked a participant whether there is some other term for the <em>at sign</em> in English. &#8220;Sure&#8221;, she said, &#8220;it&#8217;s ampersand.&#8221; To this day I&#8217;m not sure whether she thought I said <em>et sign</em>, or genuinely mixed up <a href="http://en.wikipedia.org/wiki/Asperand">asperand</a> and <a href="http://en.wikipedia.org/wiki/Ampersand">ampersand</a>. But for quite some time after that, I happily treated @ as ampersand.</p>
<p>But neither linguistics or typography is the topic of today&#8217;s article. Let&#8217;s rather talk about ampersand (the real one) in Ruby.</p>
<p>In Ruby, an ampersand denotes a block parameter. But let&#8217;s not get ahead of ourselves. A little background might be in place.</p>
<p>One of the coolest features in Ruby are <em>code blocks</em>, or <em>closures</em>. <del>They are basically anonymous functions, but as pretty much everything in Ruby, they are also objects.</del> They are anonymous functions, that have little use just by themselves. However, you can turn them into <code>Proc</code> objects either with the <code>Proc.new</code> constructor or using the <code>lambda</code> kernel method. The common best practice to mark code blocks is to use the curly braces with one-liners and <code>do..end</code> with blocks that span multiple lines:</p>
<pre><code class="ruby">yell = lambda { puts "AAARGH!!!" }
whisper = Proc.new do
 puts "whee"
end
yell.call
whisper.call
</code></pre>
<p>âž¥</p>
<pre><code class="ruby">AAARGH!!!
whee</code></pre>
<p>Maybe the most useful application of <code>Proc</code> objects in Ruby are block parameters. Anyone with some knowledge of Ruby is familiar with the following:</p>
<pre><code class="ruby">&gt;&gt; arr = %w(apple orange kiwi)
=&gt; ["apple", "orange", "kiwi"]
&gt;&gt; arr.each {|i| puts i[0,2]}
ap
or
ki
=&gt; ["apple", "orange", "kiwi"]</code></pre>
<p>As you can see, in this case you need to use neither <code>Proc.new</code> nor <code>lambda</code> with the block; it&#8217;s converted to a <code>Proc</code> object implicitly. But as the method receives just a <code>Proc</code> object as its parameter, you could also say something like this, right:</p>
<pre><code class="ruby">&gt;&gt; put_two = lambda {|i| puts i[0,2]}
=&gt; #&lt;Proc:0x00329060@(irb):41&gt;
&gt;&gt; arr.each(put_two)</code></pre>
<p>Err, not quite. It turns out Ruby methods can take two kinds of parametersâ€”a number of normal parameters and a block parameter. In the code above the interpreter will think that the <code>put_two</code> <code>Proc</code> object is passed as a normal parameter to the <code>each</code> call, and since <code>each</code> doesn&#8217;t take any normal parameters, you will get an error:</p>
<pre><code class="ruby">&gt;&gt; arr.each(put_two)
ArgumentError: wrong number of arguments (1 for 0)
	from (irb):42:in `each'
	from (irb):42</code></pre>
<p>And this is what brings us back to the ampersand:</p>
<pre><code class="ruby">&gt;&gt; arr.each(&amp;put_two)
ap
or
ki
=&gt; ["apple", "orange", "kiwi"]</code></pre>
<p>So <strong>the ampersand is used to tell the interpreter that the following reference is the block parameter of the method</strong>.</p>
<p>One fairly common idiom in the Rails world is this kind of construct:</p>
<pre><code class="ruby">&gt;&gt; arr.map(&amp;:length)</code></pre>
<p>It is effectively the same as</p>
<pre><code class="ruby">&gt;&gt; arr.map {|i| i.length }
=&gt; [5, 6, 4]</code></pre>
<p>However, if you start a plain irb session, you will notice something isn&#8217;t quite right:</p>
<pre><code class="ruby">&gt;&gt; arr.map(&amp;:length)
TypeError: wrong argument type Symbol (expected Proc)
	from (irb):2</code></pre>
<p>That&#8217;s right. The cool shorthand method that worked so nicely in your Rails app doesn&#8217;t work in plain Ruby. That&#8217;s because there is some Rails magic behind the <code>&amp;:method</code> call. This magic is e.g. the reason why <a href="http://goruco2008.confreaks.com/06_zygmuntowicz.html">Ezra has prohibited using the shortcut in Merb framework code</a>.</p>
<p>But let&#8217;s have a closer look at what&#8217;s actually happening behind the scenes in the shortcut. The thing that&#8217;s different from our earlier calls is that there is a colon between the ampersand and the word &#8220;length&#8221;. This means that we&#8217;re not using a variable or method called <code>length</code>, but the symbol <code>:length</code>. If you&#8217;re not familiar with Ruby symbols (or even if you are), reading <a href="http://blog.hasmanythrough.com/2008/4/19/symbols-are-not-pretty-strings">Josh&#8217;s recent article on symbols</a> is a worthwhile read.</p>
<p>Now that we know that we&#8217;re trying to pass a symbol as the block parameter to a method (and that it&#8217;s not really working, as the error above indicates), we need a way to convert it to a <code>Proc</code> object like expected by the method. Ruby has a slew of type conversion methods that are called implicitly whenever it&#8217;s clear that a certain type of object is needed. Inside a string for example, <code>to_s</code> is called automatically for every object that is not a string itself:</p>
<pre><code class="ruby">&gt;&gt; "Nice array: " + arr
TypeError: can't convert Array into String
	from (irb):6:in `+'
	from (irb):6
&gt;&gt; "Nice array: #{arr}"
=&gt; "Nice array: appleorangekiwi"
&gt;&gt; "Nice array: " + arr.to_s
=&gt; "Nice array: appleorangekiwi"</code></pre>
<p>In the same vein, since a block parameter of a method needs to be a <code>Proc</code> object, <code>to_proc</code> is called automatically for all other objects in an effort to get a hold of a proc.  So could it work if we just added a <code>to_proc</code> method to the <code>Symbol</code> class? Let&#8217;s find out!</p>
<pre><code class="ruby">class Symbol
  def to_proc
    lambda {|i| i.send(self)}
  end
end</code></pre>
<p><del>Here we make <code>to_proc</code> a lambda function that will use the <code>send</code> method to call the method with the same name as the <code>Symbol</code> object in question (self) for the element that&#8217;s passed to it.</del> <em>(That got too confusing so let&#8217;s just use examples)</em>.  So</p>
<pre><code class="ruby">arr.send(:length)</code></pre>
<p>is the same as</p>
<pre><code class="ruby">arr.length</code></pre>
<p>And thus</p>
<pre><code class="ruby">:length.to_proc</code></pre>
<p>would become</p>
<pre><code class="ruby">lambda {|i| i.send(:length)}</code></pre>
<p>Now, let&#8217;s see how our new method performs:</p>
<pre><code class="ruby">&gt;&gt; arr.map(&amp;:reverse)
=&gt; ["elppa", "egnaro", "iwik"]</code></pre>
<p>Perfect!</p>
<p>While <code>Symbol#to_proc</code> is a clever and perhaps an elegant hack, it&#8217;s still kind of a hack. So should you use it in your code? I tend to side with Ezra on this. If you&#8217;re writing framework code, you should probably err on the side of readability and common usage, and thus avoid &#8220;magical shortcuts&#8221; like these. But in application code, why not. I certainly do.</p></div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jarkko Laine</span></span>

      








  


<time datetime="2008-05-08T00:00:00+03:00" pubdate data-updated="true">May 8<span>th</span>, 2008</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://jlaine.net/2008/05/08/amp-lified/" data-via="" data-counturl="http://jlaine.net/2008/05/08/amp-lified/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2008/05/05/making-capistrano-not-pant-on-cleanup/" title="Previous Post: Making capistrano not suffocate on cleanup">&laquo; Making capistrano not suffocate on cleanup</a>
      
      
        <a class="basic-alignment right" href="/2008/05/25/start-from-the-heart/" title="Next Post: Start from the Heart">Start from the Heart &raquo;</a>
      
    </p>
  </footer>
</article>

</div>


    </div>
  </div>
  <footer role="contentinfo"><ul>
  <li><a href="http://jlaine.net/jarkko">About Jarkko</a></li>
  <li><a href="http://notkea.fi"><strong>NOTKEA.FI</strong> – Notkeita ajatuksia taloudesta, teknologiasta ja elämästä suomeksi</a></li>
</ul>

<p>
  Copyright &copy; 2012 - Jarkko Laine -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '50b05efb613f5d7127000040');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>

</body>
</html>
